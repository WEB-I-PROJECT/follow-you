<style>
    .search-bar-container {
        position: relative;
        width: 300px;
        margin-bottom: 10px;
    }

    .search-input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
    }

    .search-icon {
        position: absolute;
        top: 50%;
        right: 1px;
        transform: translateY(-50%);
        cursor: pointer;
        background-color: #C4170C;
        padding: 10px;
        border-radius: 0 5px 5px 0;
    }

    .search-icon i {
        color: white;
    }
</style>


<div class="modal fade" id="modalRegisterForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold">Adicionar Administrador</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body mx-3">
                <form id="adminForm">
                    <div class="md-form mb-5">
                        <i class="fas fa-user prefix grey-text"></i>
                        <label data-error="wrong" data-success="right" for="orangeForm-name">Nome</label>
                        <input type="text" id="orangeForm-name" name="name" placeholder="Insira seu nome completo"
                            required class="form-control validate">
                    </div>
  
                    <div class="md-form mb-5">
                        <i class="fas fa-envelope prefix grey-text"></i>
                        <label data-error="wrong" data-success="right" for="orangeForm-email">E-mail</label>
                        <input type="email" id="orangeForm-email" name="email" placeholder="Insira seu e-mail" required
                            class="form-control validate">
                    </div>
                    <div class="md-form mb-5">
                        <i class="fas fa-map-marker-alt prefix grey-text"></i>
                        <label data-error="wrong" data-success="right" for="orangeForm-pass">Endereço</label>
                        <input type="text" id="orangeForm-address" name="address" placeholder="Insira seu endereço"
                            required class="form-control validate">
                    </div>
                    <div class="md-form mb-5">
                        <i class="fas fa-id-card prefix grey-text"></i>
                        <label data-error="wrong" data-success="right" for="orangeForm-pass">CPF</label>
                        <input type="text" id="orangeForm-cpf" name="cpf" placeholder="Insira seu CPF" required
                            class="form-control validate">
                    </div>
                    <div class="md-form mb-5">
                        <i class="fas fa-phone prefix grey-text"></i>
                        <label data-error="wrong" data-success="right" for="orangeForm-pass">Telefone</label>
                        <input type="text" id="orangeForm-phone" name="phone" placeholder="Insira seu telefone" required
                            class="form-control validate">
                    </div>
                    <div class="md-form mb-4">
                        <i class="fas fa-lock prefix grey-text"></i>
                        <label data-error="wrong" data-success="right" for="orangeForm-pass">Senha</label>
                        <input type="password" id="orangeForm-pass" name="password" placeholder="Insira sua senha"
                            required class="form-control validate">
                    </div>
                    <div class="d-flex justify-content-center">
                        <button id="submitAdminForm" class="btn btn-deep-orange">Adicionar</button>

                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

<script>
   
    document.getElementById('submitAdminForm').addEventListener('click', function (event) {
        event.preventDefault();

        var form = document.getElementById('adminForm');
        var formData = $(form).serializeArray();

        var isValid = true;
        formData.forEach(function (field) {
            if (field.value.trim() === '') {
                isValid = false;
            }
        });

        var password = formData.find(field => field.name === 'password').value;
        if (password.length < 4) {
            alert('A senha deve ter pelo menos 4 caracteres.');
            return;
        }

        
        if (!isValid) {
            alert('Por favor, preencha todos os campos do formulário.');
            return;
        }

        var jsonData = {};
        formData.forEach(function (field) {
            jsonData[field.name] = field.value;
        });

        fetch('/adicionar-adm', {
            method: 'POST',
            body: JSON.stringify(jsonData), 
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                if (response.ok) {
                    window.location.href = '/listar-aprovados'; 
                } else {
                    throw new Error('Erro ao adicionar administrador');
                }
            })
            .catch(error => {
                console.error('Erro:', error);
            });
    });

    
  
</script>

<div class="container">

    <br><h2>Controle de Usuários</h2>
   <div class="search-bar-container">
    <input type="text" class="search-input" id="searchInput" placeholder="Pesquisar...">
    <div class="search-icon">
        <i class="bi bi-search"></i>
    </div>
</div>


    <div class="container table-responsive"><br>
        <div class="btn">
            <div class="btn">
                <a href="#" class="btn btn-success" data-toggle="modal" data-target="#modalRegisterForm">Adicionar
                    Adm</a>
            </div>
        </div>

        <table class="table table-striped table-bordered rounded shadow">
            <thead class="thead-dark">

                <tr>
                    <th scope="col">Nome</th>
                    <th scope="col">CPF</th>
                    <th scope="col">E-mail</th>
                    <th scope="col">Telefone</th>
                    <th scope="col">Desativar</th>
                </tr>

            <tbody>
                {{#each user}}
                {{#if approved}}
                <tr>
                    <td>{{name}}</td>
                    <td>{{cpf}}</td>
                    <td>{{email}}</td>
                    <td>{{phone}}</td>

                    <td class="text-center">
                        <form action="/deny-user/{{_id}}" method="POST" style="display:inline;">
                            <button type="submit" class="btn btn-danger"><i
                                    class="bi bi-person-x"></i>Desativar</button>
                        </form>
                    </td>
                </tr>
                {{/if}}
                {{/each}}
            </tbody>
            </thead>
            {{#unless user}}
            <h4 class="mt-3">Nenhum usuário cadastrado!</h4>
            {{/unless}}
        </table>
    </div>
</div>

<script>
    const searchInput = document.querySelector('.search-input');
    const searchIcon = document.querySelector('.search-icon');

    searchIcon.addEventListener('click', function() {
        searchTable();
    });

    searchInput.addEventListener('input', function() {
        searchTable();
    });

    function searchTable() {
        const searchTerm = searchInput.value.toLowerCase();

        const table = document.querySelector('.table');
        const rows = table.querySelectorAll('tbody tr');

        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            let found = false;

            cells.forEach(cell => {
                if (cell.textContent.toLowerCase().includes(searchTerm)) {
                    found = true;
                }
            });

            if (found) {
                row.style.display = 'table-row';
            } else {
                row.style.display = 'none';
            }
        });
    }
</script>